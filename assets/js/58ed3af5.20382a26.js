"use strict";(self.webpackChunkduelink=self.webpackChunkduelink||[]).push([[6404],{1333:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"engine/intro","title":"Internal Engine","description":"---","source":"@site/docs/engine/intro.mdx","sourceDirName":"engine","slug":"/engine/intro","permalink":"/docs/engine/intro","draft":false,"unlisted":false,"editUrl":"https://github.com/ghi-electronics/duelink-website/tree/dev/docs/engine/intro.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Wireless","permalink":"/docs/interface/wireless"},"next":{"title":"Scripting Language","permalink":"/docs/engine/scripting"}}');var s=r(4848),d=r(8453);const t={},o="Internal Engine",a={},c=[{value:"Immediate Mode",id:"immediate-mode",level:2},{value:"Record Mode",id:"record-mode",level:2},{value:"Hybrid Mode",id:"hybrid-mode",level:2},{value:"Asynchronous Immediate",id:"asynchronous-immediate",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",hr:"hr",img:"img",p:"p",pre:"pre",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"internal-engine",children:"Internal Engine"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["DUELink modules run an Internal Engine that is used to handle commands over multiple ",(0,s.jsx)(n.a,{href:"../interface/intro",children:"Interfaces"}),". It also manages and handles ",(0,s.jsx)(n.a,{href:"./daisylink",children:"DaisyLink"})," modules on the ",(0,s.jsx)(n.a,{href:"../interface/downlink",children:"Downlink"})," socket."]}),"\n",(0,s.jsxs)(n.p,{children:["The engine also allows the module to run ",(0,s.jsx)(n.a,{href:"../language/standalone",children:"Standalone"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["All above is possible via the built-in DUELink ",(0,s.jsx)(n.a,{href:"./scripting",children:"Scripting Engine"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["The DUELink Engine has two modes ",(0,s.jsx)(n.code,{children:"Immediate Mode"}),", where commands are executed immediately, and ",(0,s.jsx)(n.code,{children:"Record Mode"})," where commands are stored internally in the module."]}),"\n",(0,s.jsxs)(n.p,{children:["DUELink ",(0,s.jsx)(n.a,{href:"../console",children:"Console"})," handles both modes without the users needing to understand any details. This section helps in understanding the engine internals."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"immediate-mode",children:"Immediate Mode"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Immediate Mode"})," is ideal for sending a single line command to trigger an actuator into action or read sensor data. For example, a command can be ",(0,s.jsx)(n.code,{children:"StatLed(200,200,50)"}),", to blink the status LED 50 times with a 200ms on/off interval."]}),"\n",(0,s.jsxs)(n.p,{children:["It is possible to send multiple commands in a single ",(0,s.jsx)(n.code,{children:"Immediate Mode"})," shot by adding ",(0,s.jsx)(n.code,{children:":"})," between commands. For example: ",(0,s.jsx)(n.code,{children:'StatLed(200,200,50):Print("DUELink")'}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["To test the inter-working of the engine manually, we will use a terminal software instead of using ",(0,s.jsx)(n.a,{href:"../console",children:"Console"}),". Open terminal software and connect it to the serial port presented by the connected DUELink module. We like ",(0,s.jsx)(n.a,{href:"https://teratermproject.github.io/index-en.html",children:"Tera Term"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"/img/teraterm-logo.png",alt:"Tera Term"})}),"\n",(0,s.jsxs)(n.p,{children:["The first you do is hit ",(0,s.jsx)(n.code,{children:"enter"}),". This is required by the module on power up so it can detect the correct ",(0,s.jsx)(n.a,{href:"../interface/intro",children:"Interface"}),". This will result with ",(0,s.jsx)(n.code,{children:">"})," prompt. It is possible that a module is running an internal script with an infinite loop and it does not respond to commands. In this case, pressing the ",(0,s.jsx)(n.code,{children:"escape"})," key will terminate the running internal script."]}),"\n",(0,s.jsxs)(n.p,{children:["To be safe, just hit ",(0,s.jsx)(n.code,{children:"escape"})," then ",(0,s.jsx)(n.code,{children:"enter"}),"! You will for sure see ",(0,s.jsx)(n.code,{children:">"})," prompt coming back. The device is now ready to accept commands in ",(0,s.jsx)(n.code,{children:"Immediate Mode"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["By default, the device will not echo back what you enter. You can either enable echo from the device using ",(0,s.jsx)(n.code,{children:"Echo(1)"})," command or by using local eco feature in the terminal software."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Immediate Mode is the default mode on power up."})}),"\n",(0,s.jsxs)(n.p,{children:["Type ",(0,s.jsx)(n.code,{children:'Print("Hello World")'})," and hit enter. The engine will execute the ",(0,s.jsx)(n.code,{children:"Print"})," command and show ",(0,s.jsx)(n.code,{children:"Hello World"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"/img/teraterm.png",alt:"Tera Term"})}),"\n",(0,s.jsxs)(n.p,{children:["Entering ",(0,s.jsx)(n.code,{children:">"})," is the command to switch to ",(0,s.jsx)(n.code,{children:"Immediate Mode"}),". Keep a note of this once you switch to ",(0,s.jsx)(n.code,{children:"Recording Mode"})," later."]}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsx)(n.p,{children:"The engine handles backspaces and left/right arrows to help in editing the entered commands. It even has entered-command-history that can be fetched using up and down arrow keys."})}),"\n",(0,s.jsxs)(n.p,{children:["Commands are entered manually for demonstration and testing. However, in normal use ",(0,s.jsx)(n.code,{children:"Immediate Mode"})," commands come from one of the ",(0,s.jsx)(n.a,{href:"../hw/intro",children:"Supported Hardware"})," over one of the ",(0,s.jsx)(n.a,{href:"../interface/intro",children:"Interfaces"}),"."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"record-mode",children:"Record Mode"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Record Mode"})," takes the received commands and stores them internally. Those commands can be executed later using the ",(0,s.jsx)(n.code,{children:"run"})," command. Use ",(0,s.jsx)(n.code,{children:"list"})," to see a list of recorded commands, and ",(0,s.jsx)(n.code,{children:"new"})," to erase everything and start new."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"Record mode"})," is entered using the ",(0,s.jsx)(n.code,{children:"$"})," command. This will also switch the prompt to ",(0,s.jsx)(n.code,{children:"$"}),". All statements entered are stored internally and ",(0,s.jsx)(n.em,{children:"not"})," executed."]}),"\n",(0,s.jsxs)(n.p,{children:["The engine will also automatically ",(0,s.jsx)(n.code,{children:"run"})," a program on power up, if it finds one!"]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["The commands ",(0,s.jsx)(n.code,{children:"run"}),", ",(0,s.jsx)(n.code,{children:"list"}),", and ",(0,s.jsx)(n.code,{children:"new"})," are never recorded! They are used to handle the recorded program."]})}),"\n",(0,s.jsxs)(n.p,{children:["Go ahead and enter ",(0,s.jsx)(n.code,{children:"$"})," and press the enter key.\r\n",(0,s.jsx)(n.img,{src:"/img/teraterm-record.png",alt:"Tera Term Record Mode"})]}),"\n",(0,s.jsxs)(n.p,{children:["Add three lines of ",(0,s.jsx)(n.code,{children:"Print"})," commands. Nothing will get executed as those commands are getting stored internally, not executed. When finished, use ",(0,s.jsx)(n.code,{children:"list"})," to see the commands."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"/img/teraterm-print.png",alt:"Tera Term Print"})}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"run"})," to run the program."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"/img/teraterm-run.png",alt:"Tera Term Run"})}),"\n",(0,s.jsxs)(n.p,{children:["Add another command to the list then try to ",(0,s.jsx)(n.code,{children:"run"})," again."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"/img/teraterm-additem-run.png",alt:"Tera Term Add Item and Run"})}),"\n",(0,s.jsxs)(n.p,{children:["use ",(0,s.jsx)(n.code,{children:"new"})," to erase the program. Verify the program is removed using ",(0,s.jsx)(n.code,{children:"list"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"/img/teraterm-erase.png",alt:"Tera Term New"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["It is not possible to modify individual lines once recorded. This is not a problem when using the ",(0,s.jsx)(n.a,{href:"../console",children:"Console"})," as it sends the program complete in one shot."]})}),"\n",(0,s.jsx)(n.p,{children:"We can run a program that runs indefinitely using loops."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-py",children:'@Loop\r\nPrint("Hello")\r\nPrint(" world")\r\nPrint(" 123!!")\r\nGoto Loop\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"/img/teraterm-loop.png",alt:"Tera Term Loop"})}),"\n",(0,s.jsxs)(n.p,{children:["A running program can be terminated by hitting the ",(0,s.jsx)(n.code,{children:"escape"})," key. Hit ESC, then ",(0,s.jsx)(n.code,{children:"new"})," to erase the program. Verify using ",(0,s.jsx)(n.code,{children:"list"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Recording programs are either used to run the module ",(0,s.jsx)(n.a,{href:"../language/standalone",children:"Standalone"})," or to extend the module's functionality using ",(0,s.jsx)(n.a,{href:"./drivers",children:"Drivers"}),". When a module has a recorded program (driver) to extend its functionality, and those extra functions are used in immediate mode, we call this ",(0,s.jsx)(n.code,{children:"Hybrid Mode"}),"."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"hybrid-mode",children:"Hybrid Mode"}),"\n",(0,s.jsxs)(n.p,{children:["There is no ",(0,s.jsx)(n.code,{children:"Hybrid Mode"})," exactly, but you can combine both ",(0,s.jsx)(n.code,{children:"Immediate Mode"})," and ",(0,s.jsx)(n.code,{children:"Record Mode"})," to extend the system with additional commands. Say we want to extend the system with a ",(0,s.jsx)(n.code,{children:"Hello()"})," function. We can ",(0,s.jsx)(n.code,{children:"record"})," this extension that can be executed ",(0,s.jsx)(n.code,{children:"immediately"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Enter recoding mode then start a ",(0,s.jsx)(n.code,{children:"new"})," program. Then Enter this program:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-py",children:'fn Hello(b1)\r\nPrint("Hello ")\r\nPrintLn(b1)\r\nfend\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Now, ",(0,s.jsx)(n.code,{children:"list"})," the program to make sure it was recorded properly."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"/img/teraterm-function.png",alt:"Tera Term Function"})}),"\n",(0,s.jsxs)(n.p,{children:["Switch to ",(0,s.jsx)(n.code,{children:"Immediate Mode"}),"  and enter ",(0,s.jsx)(n.code,{children:'Hello("John Due")'}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"/img/teraterm-function-print.png",alt:"Tera Term Function Print"})}),"\n",(0,s.jsxs)(n.p,{children:["This is exactly how hundreds of modules provide user-friendly ",(0,s.jsx)(n.a,{href:"./drivers",children:"drivers"}),". They all have a recorded script that handles module-specific tasks. Then these drivers commands can be executed from a ",(0,s.jsx)(n.a,{href:"../hw/intro",children:"Supported Hardware"})," over one of the ",(0,s.jsx)(n.a,{href:"../interface/intro",children:"Interfaces"}),"."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"asynchronous-immediate",children:"Asynchronous Immediate"}),"\n",(0,s.jsxs)(n.p,{children:["When the system busy running an infinite loop, it is possible to inject other commands to run asynchronously. Use ",(0,s.jsx)(n.code,{children:"Asio(1)"})," to enable this feature."]}),"\n",(0,s.jsxs)(n.p,{children:["Consider this program that loops and print the global variable ",(0,s.jsx)(n.code,{children:"_x"})," every 500ms."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-py",children:"Asio(1)\r\nwhile 1\r\nPrintLn(_x)\r\nWait(500)\r\nwend\n"})}),"\n",(0,s.jsxs)(n.p,{children:["With Asynchronous immediate enabled, we can now inject ",(0,s.jsx)(n.code,{children:"_x=5"})," at any time to change the output to 5."]}),"\n",(0,s.jsx)(n.p,{children:"This can also be used to call functions and even run loops! Any valid single-line commands can be injected asynchronously."}),"\n",(0,s.jsxs)(n.p,{children:["This is a simple program that prints whatever is in ",(0,s.jsx)(n.code,{children:"a1"})," every 500ms."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-py",children:'Asio(1)\r\nfn SetA1(a2)\r\na1 = a2\r\nfend\r\n\r\nSetA1("Hello")\r\n\r\nwhile 1\r\nPrintLn(a1)\r\nWait(500)\r\nwend\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Now we can inject ",(0,s.jsx)(n.code,{children:'SetA1("DUELink")'}),". Of course, you can just do ",(0,s.jsx)(n.code,{children:'a1[]="Try it"'})," but we used a function to show the possibilities."]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);