##### RS485 #####

fn Rset()
    cmd("reset(0)") # reset my client
    reset(0) # reset myself
fend

_r = 5 # re pin
_d = 6 # de pin

fn Test()
    println("Starting test...")
    Wait(1)
    dlmode(2,0)
    Wait(10)

    SerCfg(9600, 128)
    dwrite(_r, 0) # This pin can be low all the time 
    
    while (1)    
        dwrite(_d, 1)
        SerWr('a')
        dwrite(_d, 0)
        
        n = tickms() + 1000
        
        while (tickms() < n)
            if (SerB2R() > 0)
                break
            end
            wait(1)
        wend
                
        if (SerB2R() > 0)
            b = SerRd()
            
            if (b = 'b')
                println("Passed")
                wait(1000)
            end
        end
        
        wait(10)                
    wend
fend 